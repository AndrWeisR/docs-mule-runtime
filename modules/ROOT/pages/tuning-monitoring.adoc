= Performance Monitoring
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

To complement the best practices for performance, it is necessary to monitor the resource consumed by the Mule runtime engine and know what resources have been exhausted during the tests.

The following categories can help to monitor the main system resources:

== CPU
CPU resources can be exhausted due to increased load making it one of the main resources to monitor. There are several ways to do it, two of the simple ones are:
* Top
** Command: `top`
** CPU percentage = CPU usage / number of cores

.TOP command
image::mruntime-tuning-monitoring-top.png[TOP command]

* Sar
** Command: `sar -u  ALL $INTERVAL $COUNT`
** The main metrics to pay attention are `%usr`, `%sys`, and `%idle`.

.Sar command CPU stats
image::mruntime-tuning-sar-cpu.png[Sar command CPU stats]

== Memory
To understand how Mule memory is used, including heap and native memory/off-heap buffers, is necessary to monitor the memory. There are several ways to do it, two of the simple ones are:
* GC log
Enable the GC logging to obtain the allocation rate, object growth, etc. and information about the activities in the heap.

.wrapper.conf
image::mruntime-tuning-wrapper.png[wrapper.conf]

* Sar
Command: `sar -r $INTERVAL $COUNT`
The main metrics to pay attention are `kbmemfree`, `kbmemused`, and `kbcommit`.

.Sar command Memory stats
image::mruntime-tuning-sar-memory.png[Sar command Memory stats]

== Disk
Some of the Mule runtime engine components, log writing and scenarios with large payloads treated as repeatable streams exhibit that the exhausted resource is the IO, making it another main resource to monitor. The simple way to do it is:

* Sar
Command: `sar -d -p $INTERVAL $COUNT`
The main metrics to pay attention to are `await` and `%util` that help to find out the reador write rate and the utilization on your disks.

.Sar command Disk stats
image::mruntime-tuning-sar-disk.png[Sar command Disk stats]

== Network
One of the main purposes of Mule is to interconnect with several services, all of which are communicated by the net. For that, the network infrastructure can become a bottleneck and it is necessary to know the bandwidth and monitor the utilization to establish if the network is saturated. The simple way to do it is:

* Sar
Command: `sar -n DEV $INTERVAL $COUNT`
The main metrics to pay attention to are `rxpck/s` and `txpck/s` that help to find out the network receive and transmit rate.

.Sar command Network stats
image::mruntime-tuning-sar-network.png[Sar command Network stats]

== Cloudhub Monitoring
To monitor Runtime applications running in Cloudhub environment, you can use the Runtime Manager Dashboard to visualize key performance metrics (Messages/transactions, CPU usage and Memory Usage) for a specific time period with different granularity (Last hour, last 24 hours and last week)

.Runtime Manager Dashboard
image::mruntime-tuning-runtimemanager.png[Runtime Manager Dashboard]

Another tool you can use is the Anypoint Monitoring, to keep track and visualize your performance metrics by using built-in or custom dashboards exposing the metrics of your applications through visual representations of your resources. You can detect anomalies, troubleshoot issues, and see trends that are not obvious in raw form.

.Anypoint Monitoring Dashboard
image::mruntime-tuning-anypointmonitoring.png[Anypoint Monitoring Dashboard]
